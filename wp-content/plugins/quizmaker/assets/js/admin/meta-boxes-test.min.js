jQuery(function(a){var t=a("#random_question_type");"selected"==t.val()&&a("#random-questions-1").css("display","block"),"per"==t.val()&&a("#random-questions-2").css("display","block"),t.change(function(){a("#random-questions-1, #random-questions-2").css("display","none"),"selected"==a(this).val()&&a("#random-questions-1").css("display","block"),"per"==a(this).val()&&a("#random-questions-2").css("display","block")});new AWS_Table_Data(a(".results-box"),{delay:2}).init(),a(".results-box").on("aws-table-data-after-loading-data",function(){var t=a(this);a(this).find(".qm-result-view-all").click(function(e){var i=a(this).parents("tr");t.find(".tr-view-all").remove(),i.hasClass("show-all-view")?i.removeClass("show-all-view"):QM_Model().get({action:"quizmaker_get_test_all_results",tid:meta_boxes_test_script.post_id,uid:a(this).data("uid")}).then(function(t){a('<tr class="tr-view-all"><td colspan="8"><table cellpadding="0" cellspacing="0" class="widefat wp-list-table"><tbody></tbody></table></td></tr>'),i.after(a(t.html)),a(".results-box .show-all-view").removeClass("show-all-view"),i.addClass("show-all-view")}),e.preventDefault()})}),a("#qm-remove-test-results").click(function(t){var e=a(this),i=a(".spinner-results-action");e.addClass("disabled"),i.css("visibility","visible"),QM_Model().get({action:"quizmaker_remove_test_results",tid:meta_boxes_test_script.post_id}).then(function(t){a(".results-box").trigger("aws-table-data-no-data"),e.removeClass("disabled"),i.css("visibility","hidden")}),t.preventDefault()}),function(){return{init:function(){this.ajax_action=a(".qm-list-fixed-questions").data("ajax-action"),this.ajax_security=a(".qm-list-fixed-questions").data("ajax-security"),this.ajax_url=a(".qm-list-fixed-questions").data("ajax-url"),this.ajax_params=a(".qm-list-fixed-questions").data("ajax-params"),this.table_data=new AWS_Table_Data(a(".qm-list-fixed-questions"),{delay:1}),this.events(),this.table_data.init()},events:function(){var t=this;a("#add-fixed-question").click(function(e){var i=a("#input-add-fixed_questions").val();i&&a.when(t.table_data.action("add",{data:{is_refresh:1,ids:i}})).then(function(){t.table_data.refresh(),a("#input-add-fixed_questions").val("").trigger("change")}),e.preventDefault()}),a("#order-fixed-question").click(function(e){var i=a(this);if(i.addClass("disabled"),t.table_data.has_data()>0){var n=[];a.post(t.ajax_url,{action:t.ajax_action,security:t.ajax_security,data:{test_id:t.ajax_params.test_id,method:"get_order",action_data:{is_refresh:0}}},function(e){var s=a(e.html);new AWS_UI_Dialog(s,{title:"Order Questions",width:500,height:600,show_scroll:!0}).show(),s.sortable({stop:function(t,e){n=a(this).sortable("toArray",{attribute:"data-id"})}}),s.on("aws-ui-dialog-event-ok",function(){n.length>0&&a.post(t.ajax_url,{action:t.ajax_action,security:t.ajax_security,data:{test_id:t.ajax_params.test_id,method:"update_order",action_data:{is_refresh:1,ids:n}}},function(){t.table_data.refresh()})}),s.on("aws-ui-dialog-event-cancel",function(){t.table_data.refresh()}),i.removeClass("disabled")})}e.preventDefault()}),a("#remove-fixed-question").click(function(e){var i=t.table_data.get_selected(),n=a(this);n.addClass("disabled"),i.length>0&&a.when(t.table_data.action("remove",{data:{is_refresh:1,ids:i}})).then(function(){t.table_data.refresh(),n.removeClass("disabled")}),e.preventDefault()})}}}().init(),function(){return{init:function(){this.events()},events:function(){var t=this;a("#qm-table-ranking_data .edit_ranking").click(function(e){e.preventDefault(),t.edit(a(this))}),a("#qm-table-ranking_data .save_ranking").click(function(e){e.preventDefault(),t.save(a(this).data("id"))}),a("#qm-table-ranking_data .close_ranking").click(function(e){e.preventDefault(),t.close(a(this).data("id"))}),a("#qm-table-ranking_data .remove_ranking").click(function(e){e.preventDefault(),t.remove(a(this))}),a("#add-ranking").click(function(a){a.preventDefault(),t.add()})},edit:function(t){var e=t.parent("td").parent("tr"),i=a("#qm-table-ranking_data .row_data"),n=a("#qm-table-ranking_data .qm-table-group-input"),s=e.next(".qm-table-group-input");s.hasClass("active")?(e.removeClass("active"),s.removeClass("active")):(n.removeClass("active"),s.addClass("active"),i.removeClass("active"),e.addClass("active"))},add:function(){var t=this,e=a("#qm-table-ranking_data .tbody_data"),i=a("#qm-table-ranking_data .qm-table-group-input-dump").clone();i.removeClass("qm-table-group-input-dump").addClass("qm-table-group-input active"),i.find(".close_add_ranking").click(function(a){a.preventDefault(),i.remove()}),i.find(".add_ranking").click(function(n){n.preventDefault();var s=i.find("input[name=qm_ranking_min]").val(),d=i.find("input[name=qm_ranking_max]").val(),r=i.find("input[name=qm_ranking_name]").val(),l=i.find("select[name=qm_ranking_certificate]").val(),o=i.find("input, select"),c={};o.each(function(){c[a(this).attr("name").replace("qm_ranking_","")]=a(this).val()}),t.store(c).then(function(n){var o=n.id,c=(i.clone(),a(".row_data.dump").clone()),u=c.find(".edit_ranking"),_=c.find(".remove_ranking");u.data("id",o),_.data("id",o),u.removeClass("hide").click(function(e){e.preventDefault(),t.edit(a(this))}),_.removeClass("hide").click(function(e){e.preventDefault(),t.remove(a(this))}),c.removeClass("dump"),c.data("id",o),c.find(".min_data").html(s),c.find(".max_data").html(d),c.find(".name_data").html(r),c.find(".certificate_data").html(n.data.certificate),e.append(c);var m=i.clone();m.removeClass("active").addClass("qm-table-group-input"),m.find("input[name=qm_ranking_min]").attr("name","qm_ranking_"+o+"_min").val(s),m.find("input[name=qm_ranking_max]").attr("name","qm_ranking_"+o+"_max").val(d),m.find("input[name=qm_ranking_name]").attr("name","qm_ranking_"+o+"_name").val(r),m.find("select[name=qm_ranking_certificate]").attr("name","qm_ranking_"+o+"_certificate").val(l),m.find(".add_ranking, .close_add_ranking").remove(),m.find(".save_ranking").removeClass("hide").data("id",o).click(function(e){t.save(a(this).data("id")),e.preventDefault()}),e.append(m),e.find(".ranking_nodata").addClass("hide"),i.remove(),QM().Message().inform("Success!")},function(a){QM().Message().inform(a,{type:"qm-error"})})}),a("#qm-table-ranking_data tbody.tbody_add").append(i)},store:function(a){return QM_Model({is_validated:this.is_save_validate(a)}).get({action:"quizmaker_save_ranking",tid:meta_boxes_test_script.post_id,data:a})},save:function(t){var e=this,i=a(".row_data[data-id="+t+"]").next(".qm-table-group-input.active"),n={id:t};i.find("input,select").each(function(){n[a(this).attr("name").replace("qm_ranking_"+t+"_","")]=a(this).val()}),this.store(n).then(function(a){void 0!==a.data&&(e.updateActiveRowData(a.data),e.closeActiveRowData(),QM().Message().inform("Success!"))},function(a){QM().Message().inform(a,{type:"qm-error"})})},close:function(a){this.closeActiveRowData()},remove:function(a){var t=a.parent("td").parent("tr"),e=t.next(".qm-table-group-input"),i=a.data("id");return this.is_remove_validate(i)&&QM_Model().get({action:"quizmaker_remove_ranking",tid:meta_boxes_test_script.post_id,id:i}).then(function(){t.remove(),e.remove(),QM().Message().inform("Remove Success!")}),!1},updateActiveRowData:function(t){var e=a("#qm-table-ranking_data"),i=e.find(".row_data.active");i.find(".min_data").html(t.min),i.find(".max_data").html(t.max),i.find(".name_data").html(t.name),i.find(".certificate_data").html(t.certificate)},closeActiveRowData:function(){var t=a("#qm-table-ranking_data"),e=t.find(".row_data.active"),i=e.next(".qm-table-group-input.active");e.removeClass("active"),i.removeClass("active")},is_save_validate:function(a){return""!=a&&void 0!==a&&!(parseInt(a.min)>parseInt(a.max)||""==a.name)},is_remove_validate:function(a){return!0}}}().init(),function(){return{init:function(){this.table_data=new AWS_Table_Data(a(".qm-list-assign-users"),{delay:3}),this.events(),this.table_data.init()},events:function(){var t=this;a("#lightbox-assign-users").click(function(e){var i=a("#input-assign-users").val();i&&a.when(t.table_data.action("add",{data:{ids:i}})).then(function(){t.table_data.refresh(),a("#input-assign-users").val("").trigger("change")}),e.preventDefault()}),a("#remove-assign_users").click(function(e){var i=t.table_data.get_selected(),n=a(this);n.addClass("disabled"),i.length>0&&a.when(t.table_data.action("remove",{data:{ids:i}})).then(function(){t.table_data.refresh(),n.removeClass("disabled")}),e.preventDefault()}),a("#email-assign-users").click(function(e){e.preventDefault();var i=t.table_data.get_selected(),n=a(this);n.addClass("disabled"),i.length>0&&a.when(t.table_data.action("email",{data:{ids:i},is_refresh:!1})).then(function(){n.removeClass("disabled")}),e.preventDefault()})},is_save_validate:function(a){return""!=a&&void 0!==a},is_remove_validate:function(a){return void 0!==a},is_email_add_validate:function(a){return void 0!==a&&0!=a.length}}}().init(),setTimeout(function(){QM_Verify().init()},500)});