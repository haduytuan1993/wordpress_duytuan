jQuery(function(t){t(".qm-checkall").change(function(e){var i=t(this).val();t(this).is(":checked")?t("."+i).prop("checked",!0):t("."+i).prop("checked",!1)}),t(".qm-table-pagination .qm-pagi").click(function(e){e.preventDefault();var i=t(this).parent(".qm-table-pagination"),n=t(this).data("page"),s=t("."+i.data("container"));s.find(".qm-table-page").removeClass("show"),i.find(".qm-pagi").removeClass("active"),t(this).addClass("active"),s.find("."+n).addClass("show")});var e=t(".qm-panel-tabs");t.each(e,function(e,i){var n=t(i).find(".qm-tabs"),s=n.children("li"),a=t(i).find(".qm-panel-tabs");s.click(function(e){var i=t(this).data("tab");s.removeClass("active"),a.css("display","none"),t(this).addClass("active"),a.filter("."+i+"_data").css("display","block"),e.preventDefault()}),s.filter(".default").trigger("click")}),QM_Verify=function(){return{init:function(){t.post(quizmaker.ajax_url+"?t="+(new Date).valueOf(),{action:"quizmaker_check_verify",security:quizmaker.security},function(t){0==t.status&&(window.location.href=quizmaker.verify_link)})}}},QM_Dialog=function(e,i){i=_.extend({width:400,height:300,title:"Dialog"},i);var n=t.Deferred(),s=t("body"),a=t('<div class="qm-dialog"><div class="overlay"></div><div class="qm-dialog_content"><div class="qm-dialog_content_title">'+i.title+'</div><button class="qm-dialog_close"></button><div class="qm-dialog_content_body"></div><div class="qm-dialog_content_action"><div class="qm-pull-right"><button class="button btn-cancel">Cancel</button><button class="button button-primary btn-ok">OK</button></div></div></div></div>'),o=a.find(".qm-dialog_close"),c=a.find(".qm-dialog_content"),l=a.find(".qm-dialog_content_body"),d=a.find(".overlay"),r=a.find(".btn-ok"),u=a.find(".btn-cancel"),f={init:function(){this.events()},show:function(){return this.setPosition(),c.find(".qm-dialog_content_body").html(e),s.append(a),n.promise()},close:function(){a.remove()},events:function(){var e=this;t(window).resize(function(){e.setPosition()}),d.click(function(){e.close()}),o.click(function(){e.close()}),u.click(function(){e.close()}),r.click(function(t){n.resolve(),e.close(),t.preventDefault()})},setPosition:function(){var e=t(window).width(),n=t(window).height(),s=i.width,a=i.height,o=10,d=0;e<s&&(s=e-10),n<a&&(a=n-70),d=(e-s)/2,o=(n-a)/2,c.css({width:s,height:a,top:o,left:d}),l.css({height:a-41-48})}};return f.init(),f},QM_Model=function(e){e=_.extend({is_validated:!0},e);var i=quizmaker.security;return{get:function(n){var s=t.Deferred();return n=_.extend({security:i},n),e.is_validated?t.getJSON(quizmaker.ajax_url,n,function(t){void 0!==t||null!=t||0!=typeof t.error?s.resolve(t):s.reject(t.error)}):s.reject("Error"),s.promise()},post:function(n){var s=t.Deferred();return n=_.extend({security:i},n),e.is_validated?t.post(quizmaker.ajax_url,n,function(t){void 0!==t||null!=t||0!=typeof t.error?s.resolve(t):s.reject(t.error)}):s.reject("Error"),s.promise()},save:function(n){var s=t.Deferred();return n=_.extend({security:i},n),e.is_validated?t.post(quizmaker.ajax_url,n,function(t){void 0!==t||null!=t||0==typeof t.error?s.resolve(t):s.reject(t.error)}):s.reject("Error"),s.promise()},validate:function(){}}},QM_Switch_Number=function(){var e=t(".qm-input-switch-number"),i=function(t,e){var i=t.find(".qm-input-switch-number-input-slide"),n=t.find(".qm-input-switch-number-input-on"),s=t.find(".qm-input-switch-number-info-on"),a=t.find(".qm-input-switch-number-info-off"),o=n.find("input"),c=o.data("off");if(void 0===c&&(c=0),void 0!==e&&e!=c||(e="off"),t.data("state",e),t.addClass(e),"off"==e)i.removeClass("on").addClass("off"),n.find("input").val(c),s.css("display","none"),a.css("display","block");else{i.removeClass("off"),i.addClass("on"),s.css("display","block"),a.css("display","none");var l=o.val();l<=c&&(l=c+1),o.val(l)}};e.each(function(e,n){var s=t(this),a=t(this).find(".qm-input-switch-number-input-slide"),o=t(this).find(".qm-input-switch-number-input-on"),c=o.find("input"),l=c.data("off"),d="off";c.val()>l&&(d="on"),void 0===l&&(l=0),i(t(this),d),a.click(function(t){a.hasClass("off")?(i(s,"on"),c.focus()):i(s,"off"),t.preventDefault()}),c.blur(function(){var e=t(this).val();(""==e||!t.isNumeric(e)||e<=l)&&t(this).val(l+1)})})},QM_Switch_Select=function(){var e=t(".qm-input-switch-select"),i=function(t,e){var i,n=t.find(".qm-input-switch-select-input-slide"),s=t.find(".qm-input-switch-select-input-on"),a=t.find(".qm-input-switch-select-info-on"),o=t.find(".qm-input-switch-select-info-off"),c=s.find("input"),l=c.data("off"),d=c.data("on");void 0===l&&(l=0),void 0===d&&(d=1),i=e==d?"on":"off",t.data("state",i),t.addClass(i),"off"==i?(n.removeClass("on").addClass("off"),c.val(l),a.css("display","none"),o.css("display","block")):(n.removeClass("off"),n.addClass("on"),a.css("display","block"),o.css("display","none"),c.val(d))};e.each(function(e,n){var s=t(this),a=t(this).find(".qm-input-switch-select-input-slide"),o=t(this).find(".qm-input-switch-select-input-on"),c=o.find("input"),l=c.data("off"),d=c.data("on");i(t(this),c.val()),a.click(function(t){n=o.find("input").val(),state=n==d?"on":"off","off"==state?(i(s,d),c.focus()):i(s,l),t.preventDefault()})})},QM_Select2=function(e){t(".qm-select2").each(function(){var e=t(this),i=jQuery(this).data("exclude");i||(i=[]),e.select2({theme:"aws",placeholder:jQuery(this).data("placeholder"),escapeMarkup:function(t){return t},allowClear:!0,minimumResultsForSearch:20,minimumInputLength:3,ajax:{url:quizmaker.ajax_url,dataType:"json",delay:250,data:function(t){var e=jQuery(this).val();return e||(e=[]),i=i.concat(e),{term:t.term,page:t.page,action:jQuery(this).data("action"),security:jQuery(this).data("security"),exclude:i,limit:jQuery(this).data("limit"),others:jQuery(this).data("others")}},placeholder:jQuery(this).data("placeholder"),processResults2:function(t,e){return e.page=e.page||1,console.log(t),{results:t.items,pagination:{more:30*e.page<t.total_count}}},processResults:function(t){var e=[];return t&&jQuery.each(t,function(t,i){e.push({id:t,text:i})}),{results:e}},cache:!0}}).on("quizmaker:clear_select2",function(){e.val(""),e.trigger("change")})})},QM=function(){var e;return{QuestionLightbox:function(e){e=_.extend({title:"Add question",visible_items:5},e);var i,n=t('<div id="lightbox-questions"><div class="search-box"><input type="text" placeholder="Search for a question..."/><div class="drop-panel"></div></div><div class="result-search"></div></div>'),s=n.find(".search-box"),a=s.find("input"),o=n.find(".result-search"),c=new QM_Model,l=[],d=function(t,i){i.length>e.visible_items?t.css({height:28*e.visible_items+"px"}):t.css({height:"auto"})},r=function(e){var i=t('<div class="item"><button class="ion-ios-close-outline qm-remove" data-id="'+e.ID+'">close</button><span class="item-content"></span></div>');i.find(".item-content").html(e.post_title),i.find(".qm-remove").click(function(){var e=t(this).data("id");l=_.reject(l,function(t){return t.ID==e}),i.remove()}),o.append(i),l.push(e)},u=function(e){var i=t(".drop-panel"),n=t('<div class="item"/>');e.length;i.empty(),i.css("display","block"),e.length>0?t.each(e,function(e,s){var a=n.clone();a.data("value",s),a.html(s.post_title),a.click(function(){r(t(this).data("value")),t(this).addClass("selected").unbind("click"),0==i.children(".item").length&&(i.empty(),i.css("display","none"))}),i.append(a)}):i.empty(),d(i,e)};return a.keyup(function(){clearTimeout(i),i=setTimeout(function(){if(""==a.val()||a.val().length<4)return clearTimeout(i),!1;var t=a.val();c.get({action:"get_questions",s:t,pid:meta_boxes_test_script.post_id,nids:_.pluck(l,"ID")}).then(function(t){(t.data.length>0||0==t.data.length)&&u(t.data)})},300)}),t("body").click(function(e){t(e.target).is(".drop-panel")||t(e.target).is(".item")||t(".drop-panel").css("display","none")}),{show:function(t){QM_Dialog(n,e).show().then(function(){"function"==typeof t&&t(l)})},close:function(){body.find("#lightbox-questions").remove()}}},UserLightbox:function(e){e=_.extend({title:"Assign Users",visible_items:5},e);var i,n=t('<div id="lightbox-users"><div class="search-box"><input type="text" placeholder="Search for users..."/><div class="drop-panel"></div></div><div class="result-search"></div></div>'),s=n.find(".search-box"),a=s.find("input"),o=n.find(".result-search"),c=new QM_Model,l=[],d=function(t,i){i.length>e.visible_items?t.css({height:28*e.visible_items+"px"}):t.css({height:"auto"})},r=function(e){var i=t('<div class="item"><button class="ion-ios-close-outline qm-remove" data-id="'+e.id+'">close</button><span class="item-content"></span></div>');i.find(".item-content").html(e.name),i.find(".qm-remove").click(function(){var e=t(this).data("id");l=_.reject(l,function(t){return t.id==e}),i.remove()}),o.append(i),l.push(e)},u=function(e){var i=t(".drop-panel"),n=t('<div class="item"/>');e.length;i.empty(),i.css("display","block"),e.length>0?t.each(e,function(e,s){var a=n.clone();a.data("value",s),a.html(s.name),a.click(function(){r(t(this).data("value")),t(this).addClass("selected").unbind("click"),0==i.children(".item").length&&(i.empty(),i.css("display","none"))}),i.append(a)}):i.empty(),d(i,e)};return a.keyup(function(){clearTimeout(i),i=setTimeout(function(){if(""==a.val()||a.val().length<4)return clearTimeout(i),!1;var t=a.val();c.get({action:"get_users",s:t,pid:meta_boxes_test_script.post_id,nids:_.pluck(l,"id")}).then(function(t){(t.data.length>0||0==t.data.length)&&u(t.data)})},300)}),t("body").click(function(e){t(e.target).is(".drop-panel")||t(e.target).is(".item")||t(".drop-panel").css("display","none")}),{show:function(t){QM_Dialog(n,e).show().then(function(){"function"==typeof t&&t(l)})},close:function(){body.find("#lightbox-users").remove()}}},RankingLightbox:function(e){e=_.extend({title:"New Ranking"},e);var i=t('<div id="lightbox-ranking"><div class="group-input"></div></div>');return{show:function(t){QM_Dialog(i,e).show().then(function(){"function"==typeof t&&t(results)})},close:function(){body.find("#lightbox-ranking").remove()}}},WPMedia:function(t){if(e)return void e.close();e=wp.media({title:"Select or Upload Media Of Your Chosen Persuasion",button:{text:"Use this media"},multiple:!1}),e.on("select",function(){var i=e.state().get("selection").first().toJSON();"function"==typeof t.selection&&t.selection(i)}),e.open()},Message:function(){var e;return{inform:function(i,n){var s=this,a=t('<div class="qm-js-message"></div>');n=_.extend({type:"qm-success",is_auto_hide:!0,duration:4e3},n),a.addClass(n.type).addClass("show").html(i),this.element=a,a.click(function(t){t.preventDefault(),s.hide()}),n.is_auto_hide&&(e=setTimeout(function(){s.hide()},n.duration)),t("body").append(a)},hide:function(){var t=this;clearTimeout(e),this.element.removeClass("show"),setTimeout(function(){t.element.remove()},500)}}},Loading:function(){var e;return{show:function(){e=t('<div class="qm-js-loading"><div class="qm-wrap-loader"><span class="qm-loader-1"></span></div><div class="overlay"></div></div>'),t("body").append(e)},hide:function(){e.remove()}}}}},t(document).ready(function(){QM_Switch_Number(),QM_Switch_Select(),setTimeout(function(){QM_Select2()},1e3)})});