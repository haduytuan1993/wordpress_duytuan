jQuery(function(e){function t(){var t=quizmaker.security;return{get:function(a){a=_.extend({security:t},a);var i=e.Deferred(),n=quizmaker.site_url+"?qm-ajax="+a.action;return e.getJSON(n,a,function(e){i.resolve(e)}),i.promise()},post:function(a){a=_.extend({security:t},a);var i=e.Deferred(),n=quizmaker.site_url+"?qm-ajax="+a.action+"&security="+t;return e.ajax({type:"POST",method:"POST",url:n,data:a,success:function(e){i.resolve(e)},dataType:"JSONP"}),i.promise()},validate:function(){}}}function a(){var t=e(".sidebar-stage-timer");return{init:function(e){this.events(),this.setPage(1),this.setScroll()},events:function(){var a=this;e(".sidebar-toolbar-minimize").click(function(e){e.preventDefault(),t.hasClass("minimize")||t.removeClass("expand").addClass("minimize")}),e(".sidebar-toolbar-expand").click(function(e){e.preventDefault(),t.hasClass("expand")||t.removeClass("minimize").addClass("expand")}),e(".questions-minilist_page").click(function(){var t=e(this).data("page");e(this).data("id");e("body").trigger("quizmaker_event_change_page",{page:t}),a.setPage(t)}),e(".questions-minilist_page .sidebar-question").click(function(){if(0==e(this).parent(".active").length)return!1;var t=(e(this).data("page"),e(this).data("id")),a=e("#"+t);return a.length?(e("html, body").animate({scrollTop:a.offset().top},1e3),!1):void 0})},setScroll:function(){var e=t.find(".container-scroll"),a=t.height()-185;currentHeightScroll=t.find(".container-scroll").height(),a<currentHeightScroll?(e.addClass("active"),t.find(".container-scroll").height(a)):(t.find(".container-scroll").height("100%"),e.removeClass("active"))},setPage:function(t){var a=e(".questions-minilist_page");this.activePage=a.filter(".page-"+t),a.removeClass("active"),this.activePage.addClass("active")},setQuestion:function(t){var a=this.activePage.children(".sidebar-question"),i=a.filter(function(){return e(this).data("id")==t.id});1==t.hasData?i.addClass("done"):i.removeClass("done")}}}function i(){var i=new t,n=e(".doing-stage"),s=n.find(".stage-questions"),r=e(".doing-stage .stage-pagination li"),o=parseInt(n.data("pages"));return{sidebar:a(),is_loading_new_page:!1,current_page:1,init:function(){var t=this;e("body").on("quizmaker_event_change_page",function(e,a){t._showPage(a.page)}).on("quizmaker_event_last_page",function(){n.find(".qm-btn-submit-test").addClass("finished")}),this.sidebar.init(),this._showPage(1),this._events(),1==quizmaker.type_testing&&this.adaptiveEvents(),1==o&&e(".quizmaker-direction").css("display","none")},adaptiveEvents:function(){var e=quizmaker.adaptive_max_round,t=quizmaker.adaptive_round,a=quizmaker.adaptive_percent,i=new ProgressBar.SemiCircle("#adaptive_max_round_container",{strokeWidth:4,color:"#ca0808",trailColor:"#CFCFCF",text:{value:"Round 3",alignToBottom:!0},step:function(t,a,i){var n=Math.round(100*a.value());e>0?0===n?a.setText(0):a.setText(n+"%"):a.setText('<i class="material-icons adaptive_infinite_icon">all_inclusive</i>')}}),n=new ProgressBar.SemiCircle("#adaptive_percent_container",{strokeWidth:4,color:"#ca0808",trailColor:"#CFCFCF",text:{value:"1",alignToBottom:!0},step:function(e,t,a){var i=Math.round(100*t.value());0===i?t.setText(0):t.setText(i+"%")}});i.animate(t/e,{duration:1e3}),n.animate(a/100,{duration:1e3})},_isLoaded:function(e){return s.find(".qm-page-"+e).length>0},_events:function(){_self=this,r.click(function(t){if(_self.is_loading_new_page)return!1;var a=parseInt(e(this).data("index"))+1;_self._showPage(a),t.preventDefault()}),n.find(".qm_next_page").click(function(e){e.preventDefault(),_self._nextPage()}),n.find(".qm_prev_page").click(function(e){e.preventDefault(),n.find(".qm_next_page, .qm_prev_page").removeClass("inactive"),_self._prevPage(),1==_self.current_page&&n.find(".qm_prev_page").addClass("inactive")}),e("body").on("quizmaker_on_next_page",function(){_self._nextPage()}),e("body").on("quizmaker_on_prev_page",function(){_self._prevPage()}),e("body").on("quizmaker_load_new_page_complete",function(){_self.is_loading_new_page=!1}),e("body").on("quizmaker_event_change_page",function(e,t){_self.set_state_pagination(t.page)}),r.eq(0).addClass("active")},set_state_pagination:function(t){var a=e(".doing-stage .stage-pagination li");a.removeClass("active"),a.eq(t-1).addClass("active")},_add_instant_answer:function(t){if(!t)return!1;var a=this;t.find(".qm_btn_instant_answer").click(function(n){n.preventDefault(),a._activeLoading(!0),i.get({action:"get_instant_answer",post_id:quizmaker.post_id,security:quizmaker.security,id:parseInt(t.data("id")),answer:t.find("input,textarea").serializeArray()}).then(function(i){var n=e(i.data);t.find(".question_main_content").css("display","none"),t.find(".question_wrap_content").append(n),n.find(".question_next_page").click(function(t){t.preventDefault(),e("body").trigger("quizmaker_on_next_page")}),a._activeLoading(!1)})})},_add_event_question:function(t){var a=this,i=t.data("index");return t.find(".info_explanation").click(function(){var t=e(this).parents(".question"),a=t.find(".explanation");a.hasClass("show")?(a.removeClass("show"),e(this).removeClass("active"),a.hide()):(e(this).addClass("active"),a.addClass("show"),a.show())}),t.children(".question").each(function(){var t=e(this);a.is_question_single(t)?t=a._add_event_question_single(t,i):a.is_question_multiple(t)?t=a._add_event_question_multiple(t,i):a.is_question_fill_blank(t)?t=a._add_event_question_fill_blank(t,i):a.is_question_drag_match(t)?t=a._add_event_question_drag_match(t,i):a.is_question_group_match(t)?t=a._add_event_question_group_match(t,i):a.is_question_order(t)?t=a._add_event_question_order(t,i):a.is_question_guess_word(t)?t=a._add_event_question_guess_word(t,i):a.is_question_keywords(t)&&(t=a._add_event_question_keywords(t,i)),t=a._add_event_start_play(t,i),a._add_instant_answer(t)}),t},_activeLoading:function(t){e("body").trigger("quizmaker_doing_loading",t)},_nextPage:function(){if(_self.is_loading_new_page)return!1;var e=_self.current_page+1;_self._showPage(e)},_prevPage:function(){if(_self.is_loading_new_page)return!1;var e=_self.current_page-1;_self._showPage(e)},_showPage:function(t){if(t<=0||t>e(".doing-stage .stage-pagination li").length)return!1;var a=this;this._activeLoading(!0),this.current_page=t,a.sidebar.setPage(t),e(".doing-stage .stage-pagination li").removeClass("active"),e(".doing-stage .stage-pagination li").eq(t-1).addClass("active"),e("body").trigger("quizmaker_event_changed_page",{page:t,is_last:t==o}),t==o&&e("body").trigger("quizmaker_event_last_page"),this._isLoaded(t)?(this._activeLoading(!1),s.find(".qm-page").removeClass("active"),s.find(".qm-page-"+t).addClass("active"),e("body").animate({scrollTop:0},"500")):e.when(this._loadQuestions(t)).then(function(i){a._activeLoading(!1),s.find(".qm-page").removeClass("active"),s.find(".qm-page-"+t).addClass("active"),e("body").animate({scrollTop:0},"500")}),n.find(".qm_next_page, .qm_prev_page").removeClass("inactive"),e(".doing-stage .stage-pagination li").length==this.current_page?n.find(".qm_next_page").addClass("inactive"):1==this.current_page&&n.find(".qm_prev_page").addClass("inactive")},_loadQuestions:function(t,a){var n=this,r=e.Deferred(),o=t-1;return pre_data=this._get_data_at_page(o),this.is_loading_new_page=!0,i.get({action:"get_doing_questions",post_id:quizmaker.post_id,security:quizmaker.security,page:t,pre_page:o,pre_data:pre_data}).then(function(a){if(null==a||void 0!==a.is_expired&&1==a.is_expired)r.reject(a);else{var i=n._add_event_question(e(a.questions_html));s.append(i),s.fitVids(),r.resolve(a)}e("body").trigger("quizmaker_load_new_page_complete",t)}),r.promise()},_get_data_at_page:function(t){return t<0?[]:e(".questions.qm-page-"+t).find(".question").find("input,textarea").serializeArray()},_add_event_start_play:function(e,t){if(e.hasClass("is-starting")){var a=null;e.find(".start-intro").click(function(){e.removeClass("is-starting").addClass("is-started");var t=e.find(".qm-timer-value"),i=parseInt(t.data("timeout"));i>0&&(a=setInterval(function(){i--,t.text(i),0==i&&(e.addClass("finished"),clearInterval(a))},1e3))})}return e},_add_event_question_drag_match:function(t,a){var i=this,n=t.find(".group-drag-match"),s=n.find(".match-question"),r=n.find(".match-answer"),o=function(){var n=r.find(".q"),s=!1;n.each(function(){""!=e(this).val()&&0==s&&(s=!0)}),s?i.sidebar.setQuestion({id:t.data("id"),page:a,hasData:1}):i.sidebar.setQuestion({id:t.data("id"),page:a,hasData:0})};return s.draggable({containment:n,revert:"invalid",cursor:"move"}),n.find(".match-question-container").droppable({drop:function(t,a){0==e(this).find(".match-question").length?a.draggable.detach().css({top:0,left:0}).appendTo(e(this)):a.draggable.draggable("option","revert",!0)}}),r.each(function(){e(this).droppable({activeClass:"ui-state-hover",hoverClass:"ui-state-active",drop:function(t,a){0==e(this).find(".match-question").length?(a.draggable.detach().css({top:0,left:0}).appendTo(e(this).find(".value")),e(this).find(".q").val(a.draggable.data("value"))):a.draggable.draggable("option","revert",!0),e(this).addClass("ui-state-highlight"),o()},out:function(t,a){a.draggable.data("value")==e(this).find(".q").val()&&e(this).find(".q").val(""),o()}})}),t},_add_event_question_group_match:function(t,a){var i=this,n=t.find(".group-group-match"),s=(n.find(".match-items"),n.find(".match-groups"),function(){0==n.find(".match-items .match-answer").length?i.sidebar.setQuestion({id:t.data("id"),page:a,hasData:1}):i.sidebar.setQuestion({id:t.data("id"),page:a,hasData:0})});return n.find(".match-items, .match-group").sortable({items:"> div",connectWith:n.find(".connectedSortable"),stop:function(t,a){n.find(".match-group").each(function(t,a){var i=[];e(a).find(".match-answer").each(function(t,a){i.push(parseInt(e(a).data("id")))}),e(a).find("input").val(i)}),s()}}).disableSelection(),t},_add_event_question_single:function(t,a){var i=this;t.find("input").change(function(){i.sidebar.setQuestion({id:t.data("id"),page:a,hasData:1})});var n=t.find(".group-box-radio");return n.click(function(t){n.removeClass("checked"),e(this).addClass("checked")}),t},_add_event_question_multiple:function(t,a){var i=this,n=t.find("input");return n.change(function(){n.is(":checked")?i.sidebar.setQuestion({id:t.data("id"),page:a,hasData:1}):i.sidebar.setQuestion({id:t.data("id"),page:a,hasData:0})}),t.find(".group-box-checkbox").click(function(t){e(this).hasClass("checked")?e(this).removeClass("checked"):e(this).addClass("checked")}),t},_add_event_question_fill_blank:function(t,a){var i=this;return t.find("textarea").keyup(function(){""!=e(this).val()?i.sidebar.setQuestion({id:t.data("id"),page:a,hasData:1}):i.sidebar.setQuestion({id:t.data("id"),page:a,hasData:0})}),t},_add_event_question_order:function(e,t){var a=this,i=e.find(".group-order");return setTimeout(function(){i.sortable({items:"> li",placeholder:"ui-sortable-placeholder",create:function(i,n){a.sidebar.setQuestion({id:e.data("id"),page:t,hasData:1})},change:function(i,n){a.sidebar.setQuestion({id:e.data("id"),page:t,hasData:1})}})},1e3),e},_add_event_question_guess_word:function(t,a){var i=this;return t.find("input").change(function(){""!=e(this).val()?i.sidebar.setQuestion({id:t.data("id"),page:a,hasData:1}):i.sidebar.setQuestion({id:t.data("id"),page:a,hasData:0})}),t},_add_event_question_keywords:function(t,a){var i=this;return t.find("textarea").keyup(function(){""!=e(this).val()?i.sidebar.setQuestion({id:t.data("id"),page:a,hasData:1}):i.sidebar.setQuestion({id:t.data("id"),page:a,hasData:0})}),t},get_question_single_value:function(e){return e.find("input:checked").val()},get_question_multiple_value:function(e){return e.find("input:checkbox:checked").map(function(){return this.value}).get()},get_question_fill_blank_value:function(e){return e.find("textarea").val()},get_question_order_value:function(e){return e.find("input").val()},get_question_drag_match_value:function(e){return e.find("input").val()},is_question_drag_match:function(e){return"drag_match"==e.data("type")},is_question_group_match:function(e){return"group_match"==e.data("type")},is_question_single:function(e){return"single"==e.data("type")},is_question_multiple:function(e){return"multiple"==e.data("type")},is_question_fill_blank:function(e){return"fill_blank"==e.data("type")},is_question_order:function(e){return"order"==e.data("type")},is_question_guess_word:function(e){return"guess_word"==e.data("type")},is_question_keywords:function(e){return"keywords"==e.data("type")}}}setTimeout(function(){i().init()})});